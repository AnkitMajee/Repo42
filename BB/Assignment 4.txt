--Assignment 1
-- Create table ğŸ‘‡

CREATE TABLE emp (  
    empid INT(10) PRIMARY KEY,  
     fname VARCHAR2(64),  
     age INT(5),  
     salary INT(10) 
 );

INSERT INTO emp VALUES(401,'ANU',22,50000);
INSERT INTO emp VALUES(402,'SHANE',29,80000);
INSERT INTO emp VALUES(403,'ROHAN',34,100000);
INSERT INTO emp VALUES(404,'SCOTT',44,100000);
INSERT INTO emp VALUES(405,'TIGER',35,80000);

 CREATE TABLE sale (  
     order_id INT(10) PRIMARY KEY,  
     Purchase_amount INT(10),
      Purchase_date DATE,
    cust_id INT(10) 
 );


INSERT INTO sale VALUES(11,2000,'2023-08-15',402);
INSERT INTO sale VALUES(12,1000,'2023-07-25',403);
INSERT INTO sale VALUES(13,2000,'2023-07-15',405);
INSERT INTO sale VALUES(14,1000,'2023-08-25',401);
INSERT INTO sale VALUES(15,2000,'2023-07-10',405);
INSERT INTO sale VALUES(16,1500,'2023-08-15',401);
INSERT INTO sale VALUES(17,2500,'2023-07-12',402);
INSERT INTO sale VALUES(18,1600,'2023-08-15',401);

--Purchase >3000
SELECT
    e.fname AS employee_name,
    SUM(s.Purchase_amount) AS total_expenditure
FROM
    empl e
JOIN
    sale s ON e.empid = s.cust_id
GROUP BY
    e.empid, e.fname
HAVING
    SUM(s.Purchase_amount) > 3000;

--highest total order

SELECT
    fname,
    MAX(total_expenditure) AS max_expenditure
FROM
    (SELECT
        e.fname,
        SUM(s.purchase_amount) AS total_expenditure
    FROM
        empl e
    JOIN
        sale s ON e.empid = s.cust_id
    GROUP BY
        e.empid, e.fname) subquery
GROUP BY
    fname;


--2nd heighest salary

SELECT fname, salary AS Second_highest
FROM empl
ORDER BY salary DESC
OFFSET 1 ROW
FETCH FIRST 1 ROW ONLY;

-- purchase maximum times

SELECT e.fname, e.salary AS Salary
FROM empl e
JOIN sale s ON e.empid = s.cust_id
GROUP BY s.cust_id, e.fname, e.salary
HAVING COUNT(s.order_id) = (
    SELECT COUNT(s2.order_id)
    FROM sale s2
    WHERE s2.cust_id = s.cust_id
    GROUP BY s2.cust_id
    ORDER BY COUNT(s2.order_id) DESC
    FETCH FIRST 1 ROW ONLY
);




--August

SELECT SUM(purchase_amount) AS Total_August_sales
FROM sale
WHERE TO_CHAR(purchase_date, 'MM') = '08';

--july
SELECT COUNT(order_id) AS Total_August_sales
FROM sale
WHERE TO_CHAR(purchase_date, 'MM') = '07';


---after ROhan
SELECT *
FROM empl e
JOIN sale s ON e.empid = s.cust_id
WHERE s.purchase_date > (
    SELECT MIN(s2.purchase_date)
    FROM empl e2
    JOIN sale s2 ON e2.empid = s2.cust_id
    WHERE e2.fname = 'ROHAN'
);



-- Made with love ğŸ–•ğŸ–•ğŸ¿ğŸ–• for everybody to everybody --






